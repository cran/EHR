<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>EHR Vignette for Build-PK-Oral</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">EHR Vignette for <em>Build-PK-Oral</em></h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The <code>EHR</code> package provides several modules to perform diverse medication-related studies using data from electronic health record (EHR) databases. Especially, the package includes modules to perform pharmacokinetic/pharmacodynamic (PK/PD) analyses using EHRs, as outlined in Choi <em>et al.</em><span class="math inline">\(^{1}\)</span>, and additional modules will be added in the future. This vignette describes one of the PK data building modules in the system for medications that are typically orally administrated. One of the key data for this module is drug dose data that can be provided by users or generated from unstructured clinical notes using extracted dosing information with the <em>Extract-Med</em> module and processed with the <em>Pro-Med-NLP</em> module in the system.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(EHR)</code></pre></div>
<div id="build-pk-oral" class="section level2">
<h2>Build-PK-Oral</h2>
<p>Population PK datasets require a certain format in order to be analyzed by software systems specialized for PK analysis such as NONMEM. The Build-PK-Oral module requires dose data and concentration data. Demographic data (provided by users or the <em>Pro-Demographic</em> module) and laboratory data (provided by users or the <em>Pro-Laboratory</em> module) may optionally be included. Building PK datasets from EHR-extracted information may require some assumptions regarding dosing. The major functions performed in this module by <code>run_Build_PK_Oral()</code> are:</p>
<ul>
<li>Build PK data for orally administered medications using assumed dosing schedule when last-dose times are not provided.</li>
<li>Build PK data for orally administered medications using last-dose times if they are provided or extracted from clinical notes in EHRs.</li>
</ul>
<p>A possible EHR-extracted dataset follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Data generating function for examples</span>
mkdat &lt;-<span class="st"> </span><span class="cf">function</span>() {
  npat=<span class="dv">3</span>
  visits &lt;-<span class="st"> </span><span class="kw">floor</span>(<span class="kw">runif</span>(npat, <span class="dt">min=</span><span class="dv">2</span>, <span class="dt">max=</span><span class="dv">6</span>))
  id &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>npat, visits)
  dt &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">paste</span>(<span class="kw">as.Date</span>(<span class="kw">sort</span>(<span class="kw">sample</span>(<span class="dv">700</span>, <span class="kw">sum</span>(visits))), 
                                 <span class="dt">origin =</span> <span class="st">'2019-01-01'</span>), <span class="st">'10:00:00'</span>), <span class="dt">tz =</span> <span class="st">'UTC'</span>) 
  <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">sum</span>(visits), <span class="dv">0</span>, <span class="dv">1</span><span class="op">*</span><span class="dv">60</span><span class="op">*</span><span class="dv">60</span>)
  dose_morn &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="fl">2.5</span>,<span class="dv">5</span>,<span class="fl">7.5</span>,<span class="dv">10</span>), <span class="kw">sum</span>(visits), <span class="dt">replace =</span> <span class="ot">TRUE</span>)
  conc &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="kw">sum</span>(visits), <span class="fl">1.5</span><span class="op">*</span>dose_morn, <span class="dv">1</span>),<span class="dv">1</span>)
  ld &lt;-<span class="st"> </span>dt <span class="op">-</span><span class="st"> </span><span class="kw">sample</span>(<span class="dv">10</span><span class="op">:</span><span class="dv">16</span>, <span class="kw">sum</span>(visits), <span class="dt">replace =</span> <span class="ot">TRUE</span>) <span class="op">*</span><span class="st"> </span><span class="dv">3600</span>
  ld[<span class="kw">rnorm</span>(<span class="kw">sum</span>(visits)) <span class="op">&lt;</span><span class="st"> </span>.<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
  age &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">sample</span>(<span class="dv">40</span><span class="op">:</span><span class="dv">75</span>, npat), visits)
  weight &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">round</span>(<span class="kw">rnorm</span>(npat, <span class="dv">180</span>, <span class="dv">20</span>)),visits)
  hgb &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rep</span>(<span class="kw">rnorm</span>(npat, <span class="dv">10</span>, <span class="dv">2</span>), visits),<span class="dv">1</span>)
  <span class="kw">data.frame</span>(id, dt, dose_morn, conc, age, weight, hgb, ld)
}

<span class="co"># Make example data</span>
<span class="kw">set.seed</span>(<span class="dv">30</span>)
dat &lt;-<span class="st"> </span><span class="kw">mkdat</span>()
dat</code></pre></div>
<pre><code>##   id                  dt dose_morn conc age weight  hgb                  ld
## 1  1 2019-01-30 10:00:00       2.5  1.9  50    197 10.6                &lt;NA&gt;
## 2  1 2019-07-08 10:00:00      10.0 14.8  50    197 10.6                &lt;NA&gt;
## 3  2 2019-09-27 10:00:00       2.5  4.5  56    154  7.8                &lt;NA&gt;
## 4  2 2019-11-01 10:00:00      10.0 14.1  56    154  7.8 2019-10-31 22:00:00
## 5  2 2019-11-12 10:00:00       2.5  4.5  56    154  7.8                &lt;NA&gt;
## 6  3 2020-03-11 10:00:00       2.5  5.2  40    147 10.8 2020-03-11 00:00:00
## 7  3 2020-04-05 10:00:00       5.0  6.4  40    147 10.8                &lt;NA&gt;
## 8  3 2020-06-06 10:00:00       7.5 10.7  40    147 10.8 2020-06-05 19:00:00</code></pre>
<p>There are 3 individuals in the dataset, each has a set of EHR-extracted dose and blood concentrations data along with demographic data and information commonly found with laboratory data:</p>
<ul>
<li>Subject identification number (<code>id</code>)</li>
<li>Time of concentration measurement (<code>dt</code>)</li>
<li>Dose (<code>dose_morn</code>)</li>
<li>drug concentration (<code>conc</code>)</li>
<li>Age (<code>age</code>)</li>
<li>Weight (<code>weight</code>)</li>
<li>Hemoglobin (<code>hgb</code>)</li>
<li>Last-dose time (<code>ld</code>)</li>
</ul>
<p>All concentrations are being taken in the morning. Given that this is a drug which should be taken orally every 12 hours, we can construct a reasonable dosing schedule which details the amount and timing of each dose.</p>
<p>Assume that individuals take their morning dose of medicine 30 minutes after their blood is drawn for labs to check trough concentrations at clinic visit. All doses following that first one will then occur every 12 hours until the next measured concentration is within 6 to 18 hours (when no extracted last-dose times are provided). The timing of the subsequent concentration will then dictate the next sequence of doses in the same way, and so on until the final extracted concentration.</p>
<p>Additionally, it is reasonable to assume that the individual has been taking the drug of interest prior to their first measured concentration. For this reason assume that there is regular dosing leading up to the first extracted concentration, the duration of which is set by the argument <code>first_interval_hours</code>; this duration should be long enough for trough concentrations to reach a steady state.</p>
<p><code>run_Build_PK_Oral()</code> builds a PK dataset by following this logic, given specification of appropriate columns:</p>
<ul>
<li><code>idCol</code>: subject identification number</li>
<li><code>dtCol</code>: time of concentration measurement</li>
<li><code>doseCol</code>: dose</li>
<li><code>concCol</code>: drug concentration</li>
<li><code>ldCol</code>: last-dose time; the default is <code>NULL</code> to ignore</li>
<li><code>first_interval_hours</code>: Hours of regular dosing leading up to the first concentration; the default is 336 hours = 14 days</li>
<li><code>imputeClosest</code>: Vector of columns for imputation of missing data using last observation carried forward or, if unavailable, next observation propagated backward</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2 &lt;-<span class="st"> </span>dat[,<span class="op">-</span><span class="dv">8</span>]
<span class="co"># Build PK data without last-dose times</span>
<span class="kw">run_Build_PK_Oral</span>(<span class="dt">x =</span> dat2,
                  <span class="dt">idCol =</span> <span class="st">&quot;id&quot;</span>,
                  <span class="dt">dtCol =</span> <span class="st">&quot;dt&quot;</span>,
                  <span class="dt">doseCol =</span> <span class="st">&quot;dose_morn&quot;</span>,
                  <span class="dt">concCol =</span> <span class="st">&quot;conc&quot;</span>,
                  <span class="dt">ldCol =</span> <span class="ot">NULL</span>,
                  <span class="dt">first_interval_hours =</span> <span class="dv">336</span>,
                  <span class="dt">imputeClosest =</span> <span class="ot">NULL</span>)</code></pre></div>
<pre><code>##    CID   time                date conc dose addl II mdv age weight  hgb
## 1    1    0.0 2019-01-16 10:00:00   NA  2.5   27 12   1  50    197 10.6
## 2    1  336.0 2019-01-30 10:00:00  1.9   NA   NA NA   0  50    197 10.6
## 3    1  336.5 2019-01-30 10:30:00   NA  2.5  317 12   1  50    197 10.6
## 4    1 4151.0 2019-07-08 10:00:00 14.8   NA   NA NA   0  50    197 10.6
## 5    2    0.0 2019-09-13 10:00:00   NA  2.5   27 12   1  56    154  7.8
## 6    2  336.0 2019-09-27 10:00:00  4.5   NA   NA NA   0  56    154  7.8
## 7    2  336.5 2019-09-27 10:30:00   NA  2.5   69 12   1  56    154  7.8
## 8    2 1176.0 2019-11-01 10:00:00 14.1   NA   NA NA   0  56    154  7.8
## 9    2 1176.5 2019-11-01 10:30:00   NA 10.0   21 12   1  56    154  7.8
## 10   2 1441.0 2019-11-12 10:00:00  4.5   NA   NA NA   0  56    154  7.8
## 11   3    0.0 2020-02-26 09:00:00   NA  2.5   27 12   1  40    147 10.8
## 12   3  336.0 2020-03-11 10:00:00  5.2   NA   NA NA   0  40    147 10.8
## 13   3  336.5 2020-03-11 10:30:00   NA  2.5   49 12   1  40    147 10.8
## 14   3  936.0 2020-04-05 10:00:00  6.4   NA   NA NA   0  40    147 10.8
## 15   3  936.5 2020-04-05 10:30:00   NA  5.0  123 12   1  40    147 10.8
## 16   3 2424.0 2020-06-06 10:00:00 10.7   NA   NA NA   0  40    147 10.8</code></pre>
<p>Note that <code>addl</code> and <code>II</code> dictate an every-twelve-hour dosing schedule which leads up to the proceeding concentration. Covariates are preserved and a <code>time</code> variable which represents hours since first dose is generated. This data is now in an appropriate format for PK analysis but makes no use of the last-dose times although they are extracted along with some (but not all) concentrations. When last-dose times are present in the input data and they are specified in the argument <code>ldCol</code>, the sequence of doses leading up to the extracted dose is reduced and a new row is inserted which accurately describes the timing of the dose which precedes the relevant concentration.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Build PK data with last-dose times</span>
<span class="kw">run_Build_PK_Oral</span>(<span class="dt">x =</span> dat,
                  <span class="dt">idCol =</span> <span class="st">&quot;id&quot;</span>,
                  <span class="dt">dtCol =</span> <span class="st">&quot;dt&quot;</span>,
                  <span class="dt">doseCol =</span> <span class="st">&quot;dose_morn&quot;</span>,
                  <span class="dt">concCol =</span> <span class="st">&quot;conc&quot;</span>,
                  <span class="dt">ldCol =</span> <span class="st">&quot;ld&quot;</span>,
                  <span class="dt">first_interval_hours =</span> <span class="dv">336</span>,
                  <span class="dt">imputeClosest =</span> <span class="ot">NULL</span>)</code></pre></div>
<pre><code>##    CID   time                date conc dose addl II mdv age weight  hgb
## 1    1    0.0 2019-01-16 10:00:00   NA  2.5   27 12   1  50    197 10.6
## 2    1  336.0 2019-01-30 10:00:00  1.9   NA   NA NA   0  50    197 10.6
## 3    1  336.5 2019-01-30 10:30:00   NA  2.5  317 12   1  50    197 10.6
## 4    1 4151.0 2019-07-08 10:00:00 14.8   NA   NA NA   0  50    197 10.6
## 5    2    0.0 2019-09-13 10:00:00   NA  2.5   27 12   1  56    154  7.8
## 6    2  336.0 2019-09-27 10:00:00  4.5   NA   NA NA   0  56    154  7.8
## 7    2  336.5 2019-09-27 10:30:00   NA  2.5   68 12   1  56    154  7.8
## 8    2 1164.0 2019-10-31 22:00:00   NA  2.5    0 NA   1  56    154  7.8
## 9    2 1176.0 2019-11-01 10:00:00 14.1   NA   NA NA   0  56    154  7.8
## 10   2 1176.5 2019-11-01 10:30:00   NA 10.0   21 12   1  56    154  7.8
## 11   2 1441.0 2019-11-12 10:00:00  4.5   NA   NA NA   0  56    154  7.8
## 12   3    0.0 2020-02-26 09:00:00   NA  2.5   26 12   1  40    147 10.8
## 13   3  326.0 2020-03-11 00:00:00   NA  2.5    0 NA   1  40    147 10.8
## 14   3  336.0 2020-03-11 10:00:00  5.2   NA   NA NA   0  40    147 10.8
## 15   3  336.5 2020-03-11 10:30:00   NA  2.5   49 12   1  40    147 10.8
## 16   3  936.0 2020-04-05 10:00:00  6.4   NA   NA NA   0  40    147 10.8
## 17   3  936.5 2020-04-05 10:30:00   NA  5.0  122 12   1  40    147 10.8
## 18   3 2409.0 2020-06-05 19:00:00   NA  5.0    0 NA   1  40    147 10.8
## 19   3 2424.0 2020-06-06 10:00:00 10.7   NA   NA NA   0  40    147 10.8</code></pre>
<p>Individual 1 has no extracted last-dose times so their data is unchanged from before. Compare, however, rows 7-9 to rows 7-8 of the previous dataset constructed without last-dose times. The measured concentration of 14.1 on <code>date</code> 2019-11-01 is associated with a last-dose time. <code>addl</code> drops from 69 to 68 and the extracted last-dose is added in row 8 with additional <code>date</code> 2019-10-31 20:58:36, the last-dose time extracted from clinical notes. Notice that the number of doses leading up to the concentration is unchanged and the timing of the final dose has been adjusted to reflect information in the EHR (i.e., the calculated time of 1162.70 for <code>time</code>). This dataset still relies on assumptions about dosing, but should reflect the actual dosing schedule better by incorporating last-dose times from the EHR.</p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<ol style="list-style-type: decimal">
<li>Choi L, Beck C, McNeer E, Weeks HL, Williams ML, James NT, Niu X, Abou-Khalil BW, Birdwell KA, Roden DM, Stein CM. Development of a System for Post-marketing Population Pharmacokinetic and Pharmacodynamic Studies using Real-World Data from Electronic Health Records. Clinical Pharmacology &amp; Therapeutics. 2020 Apr; 107(4): 934-943.</li>
</ol>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
